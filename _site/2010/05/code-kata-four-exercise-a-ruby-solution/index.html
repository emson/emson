<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>Code Kata Four Exercise - A Ruby Solution</title> 
				<meta name="author" content="Ben Emson" />
				<link href="http://feeds.feedburner.com/ben-emson" rel="alternate" title="Ben Emsonr" type="application/atom+xml" />

			   <!-- syntax highlighting CSS -->
			   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

			   <!-- Homepage CSS -->
			   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
			   <script src="/mint/?js" type="text/javascript"></script>
    </head> 
 
    <body>  
        <div id="container"> 
 
            <h1><a href="http://blog.emson.co.uk">Ben Emson</a></h1> 
            
            <div id="post">
<h1>Code Kata Four Exercise - A Ruby Solution</h1>

<p>I recently did <a href="http://codekata.pragprog.com/2007/01/kata_four_data_.html">code kata 4 (data munging)</a>, and here is my solution to the problem. Like anything it can be improved but I think it is relatively simple to understand and yet flexible enough to work for a number of different formatted <strong>.dat</strong> files.</p>

<p>The premiss is to write a program that will work out the deltas ( difference ) between two columns in <strong>.dat</strong> files and return the lowest values.</p>

<p>These <strong>.dat</strong> files have different numbers of columns and these columns can be in different order. The two <strong>.dat</strong> files used for this program supplied weather temperature ranges and football (soccer) result scores.</p>

<p>Anyway here is my solution in the Ruby language and a description of how it works:</p>

<div class="highlight"><pre><code class="ruby"><span class="c1"># data_processor.rb</span>

<span class="k">module</span> <span class="nn">DataProcessor</span>

  <span class="k">def</span> <span class="nf">process_dat</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sr">/^\s*\d+\.?\s+/</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="no">IO</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">line</span> <span class="o">=~</span> <span class="n">regex</span>
        <span class="n">num</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">min</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">line</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">max</span><span class="o">.</span><span class="n">to_i</span> <span class="o">-</span> <span class="n">min</span><span class="o">.</span><span class="n">to_i</span>
        <span class="n">items</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">num</span><span class="p">,</span> <span class="n">delta</span><span class="o">]</span> <span class="k">if</span> <span class="n">items</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="n">current_items</span> <span class="o">=</span> <span class="n">items</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span>
        <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;=</span> <span class="n">current_items</span>
          <span class="n">items</span><span class="o">.</span><span class="n">clear</span> <span class="k">if</span> <span class="n">delta</span> <span class="o">&lt;</span> <span class="n">current_items</span>
          <span class="n">items</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">num</span><span class="p">,</span> <span class="n">delta</span><span class="o">]</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>  
    <span class="n">items</span>
  <span class="k">end</span>

<span class="k">end</span>

<span class="k">if</span> <span class="bp">__FILE__</span> <span class="o">==</span> <span class="vg">$0</span>

  <span class="kp">include</span> <span class="no">DataProcessor</span>

  <span class="nb">puts</span> <span class="s2">&quot;-------- Weather  --------&quot;</span>
  <span class="n">list</span> <span class="o">=</span> <span class="n">process_dat</span><span class="p">(</span><span class="s1">&#39;weather.dat&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">list</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;Lowest Day:</span><span class="si">#{</span><span class="n">item</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2"> Delta:</span><span class="si">#{</span><span class="n">item</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

  <span class="nb">puts</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">-------- Football --------&quot;</span>
  <span class="n">list</span> <span class="o">=</span> <span class="n">process_dat</span><span class="p">(</span><span class="s1">&#39;football.dat&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> 
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="o">[</span><span class="n">tokens</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span> <span class="n">tokens</span><span class="o">[</span><span class="mi">6</span><span class="o">]</span><span class="p">,</span> <span class="n">tokens</span><span class="o">[</span><span class="mi">8</span><span class="o">]]</span>
  <span class="k">end</span>
  <span class="n">list</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span> <span class="nb">puts</span> <span class="s2">&quot;Team:</span><span class="si">#{</span><span class="n">item</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2"> Delta:</span><span class="si">#{</span><span class="n">item</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<span class="k">end</span>
    
</code></pre>
</div>


<p>The code above was created as a <strong>module</strong> as this will allow the <strong>process_dat</strong> method to be mixed-in to other objects, allowing these objects to execute the code without having to instantiate another class to get this functionality.</p>

<p>The <strong>process_dat</strong> method takes a filename and an optional regular expression. The regular expression (regex) is used to find the data in the text file for processing. In this case any line that starts with 0 or more spaces followed by at least one number and then an optional '.' after that number followed by at least one space.  This regular expression could have been used to extract the data from each row as well - but it actually became much easier to simply split each row and tokenise it around a space, as we are processing space separated files.</p>

<p>Using the <strong>IO.foreach</strong> method will iterate over each line of the <strong>.dat</strong> file allowing the logic to process that line. This is much more memory efficient, as only one line is loaded into memory at each iteration of the loop - thus allowing this method to process very large data files.</p>

<p>Next the method checks to see if the line matches the regex (<code>if line =~ regex</code>) if it does it can be processed.</p>

<p>Processing each line is handled by a Ruby block, (as a <strong>yield</strong> statement is used), in the "weather.dat" case the block simply splits the line around a white space. In the "football.dat" case the block splits the line around the white space but re orders the returned columns. Incidentally it is useful to know that if the number of tokens in the array exceeds the number of possible assignments (<code>num, max, min = yield line</code>, where <code>yield line</code> returns a 10 item array for instance) Ruby conveniently ignores the other values after assigning the first lot.</p>

<p>The next couple of lines simply calculate the delta and assigns it to a temporary array (<code>items</code>) if items is empty. The items array simply holds the lowest values as a collection of lowest values with the same value.
Note that the items array is an array of arrays. The item in the items array consists of a number and a delta.</p>

<p>Finally we get the lowest item from the items array and check to see if the current line delta is lower if it is, clear the items array and add this new item.  If it equals the same value simply add this item to the items array.
Thus the items array will contain the same lowest values.</p>

<p>I hope you find this helpful - if you have an alternative solution, why don't you add it to the comments at the bottom.</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>24 Jun 2010</span> &raquo; <a href="/2010/06/ruby-quine-example">Ruby Quine Example</a></li>
    
      <li><span>11 May 2010</span> &raquo; <a href="/2010/05/what-is-the-difference-between-a-proc-and-a-lambda-in-ruby">What is the Difference Between a Proc and a Lambda in Ruby?</a></li>
    
      <li><span>09 Apr 2010</span> &raquo; <a href="/2010/04/javascript-the-good-parts-best-practices">JavaScript The Good Parts Best Practices</a></li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emson'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    var disqus_identifier = '/2010/05/code-kata-four-exercise-a-ruby-solution';
    var disqus_url = 'http://blog.emson.co.uk/2010/05/code-kata-four-exercise-a-ruby-solution';
    var disqus_title = 'Code Kata Four Exercise - A Ruby Solution';
    // var disqus_developer = 1;
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
 
            <div class="footer">
                <p>A project by <a href="http://blog.emson.co.uk">Ben Emson</a> | <a href="http://twitter.com/emson">@emson</a>.</p> 
            </div> 
 
        </div> 
				<!-- Google Analytics -->
    </body> 
</html>