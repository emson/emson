<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>How To Set Up and Build a Django Web Site</title> 
				<meta name="author" content="Ben Emson" />
				<link href="http://feeds.feedburner.com/ben-emson" rel="alternate" title="Ben Emsonr" type="application/atom+xml" />

			   <!-- syntax highlighting CSS -->
			   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

			   <!-- Homepage CSS -->
			   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
    </head> 
 
    <body>  
        <div id="container"> 
 
            <h1><a href="http://blog.emson.co.uk">Ben Emson</a></h1> 
            
            <div id="post">
<h1>How To Set Up and Build a Django Web Site</h1>

<p>This article outlines how to set up your new Django site from scratch. I tend to use <a href="http://www.dreamhost.com/r.cgi?105422">Dreamhost Web Site Hosting</a> so there will be a few notes specific to them.</p>

<p>If you are unsure how to set up Python and Django using <a href="http://www.dreamhost.com/r.cgi?105422">Dreamhost</a> then checkout my previous article.</p>

<p>I hope you find it useful and drop me a comment if you have any questions.</p>

<h2>Create the new site</h2>

<p>Create a project directory</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>mkdir -p mysite-project/mysite.com
<span class="nv">$ </span><span class="nb">cd </span>mysite-project/mysite.com
</code></pre>
</div>


<p>Create you new site:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>django-admin.py startproject mysite
</code></pre>
</div>


<p>Now create the following directories:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>mkdir -p mysite-project/settings
<span class="nv">$ </span>mkdir -p mysite-project/mysite.com/tmp/
<span class="nv">$ </span>mkdir -p mysite-project/mysite.com/public/appmedia
<span class="nv">$ </span>mkdir -p mysite-project/mysite.com/mysite/scripts
<span class="nv">$ </span>mkdir -p mysite-project/mysite.com/mysite/templates
</code></pre>
</div>


<h2>Initialise git</h2>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd </span>mysite-project/mysite.com
<span class="nv">$ </span>git init
<span class="nv">$ </span>touch .gitignore
</code></pre>
</div>


<p>Add the following:</p>

<pre><code>.DS_Store
*.pyc
packages/
work/
</code></pre>

<h2>Add WSGI file</h2>

<p>The following should be carried out from this directory:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd </span>mysite-project/mysite.com
</code></pre>
</div>


<p>Add the <strong>passenger_wsgi.py</strong> file to mysite-project/mysite.com directory:</p>

<div class="highlight"><pre><code class="bash">import sys, os
<span class="k">if </span>sys.hexversion &lt; 0x2060000: os.execl<span class="o">(</span><span class="s2">&quot;/home/myuser/opt/python261/bin/python2.6&quot;</span>, <span class="s2">&quot;python2.6&quot;</span>, *sys.argv<span class="o">)</span>

sys.path.append<span class="o">(</span>os.getcwd<span class="o">())</span>
<span class="c"># START</span>
<span class="c"># required if you are using VirtualEnv, to get Passenger to use local Python environment.</span>
<span class="c"># see: http://wiki.dreamhost.com/Passenger_WSGI</span>
<span class="nv">INTERP</span> <span class="o">=</span> <span class="s2">&quot;/home/myuser/virtual/bin/python2.6&quot;</span>
<span class="k">if </span>sys.executable !<span class="o">=</span> INTERP: os.execl<span class="o">(</span>INTERP, INTERP, *sys.argv<span class="o">)</span>
<span class="c"># END</span>
os.environ<span class="o">[</span><span class="s1">&#39;DJANGO_SETTINGS_MODULE&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;mysite.settings&quot;</span>
import django.core.handlers.wsgi
<span class="nv">application</span> <span class="o">=</span> django.core.handlers.wsgi.WSGIHandler<span class="o">()</span>
</code></pre>
</div>


<p>Create the public/appmedia directory in this directory to.
Create tmp/restart.txt</p>

<h2>Set up the VirtualEnv Environment</h2>

<p>Move to the mysite-project directory.
Ensure that you have virtualenv installed on your local system:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd </span>mysite-project
<span class="nv">$ </span>pip install virtualenv
</code></pre>
</div>


<p>Create the <strong>virtual/</strong> directories using virtualenv:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>virtualenv ./virtual
</code></pre>
</div>


<p>Create a symbolic link to the <strong>activate</strong> executable.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>ln -s ./virtual/bin/activate ./activate
</code></pre>
</div>


<p>NB: if you rename your mysite-project directory you may well need to delete the virtual directory and activate symbolic link and recreate them using the previous virtualenv steps.</p>

<p>You can check which Python site packages being used with this command:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>python -c <span class="s2">&quot;from distutils.sysconfig import get_python_lib; print get_python_lib()&quot;</span>
</code></pre>
</div>


<h2>Create Local Dev Database</h2>

<p>Change directory to the scripts directory in mysite-project/mysite.com/mysite:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd </span>mysite-project/mysite.com/mysite/scripts
<span class="nv">$ </span>touch scripts/create-db.sql
<span class="nv">$ </span>touch scripts/drop-db.sql
</code></pre>
</div>


<p>create-db.sql</p>

<div class="highlight"><pre><code class="sql"><span class="k">create</span> <span class="k">database</span> <span class="n">mysite_com_dev</span><span class="p">;</span>
<span class="k">grant</span> <span class="k">all</span> <span class="k">on</span> <span class="n">mysite_com_dev</span><span class="p">.</span><span class="o">*</span> <span class="k">to</span> <span class="s1">&#39;root&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span><span class="p">;</span>
</code></pre>
</div>


<p>drop-db.sql</p>

<div class="highlight"><pre><code class="sql"><span class="k">drop</span> <span class="k">database</span> <span class="n">mysite_com_dev</span><span class="p">;</span>
</code></pre>
</div>


<p>Now create the database</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>mysql -u root &lt; scripts/create-db.sql
</code></pre>
</div>


<h2>Set up the Django Project Files</h2>

<p>Make the following changes to the <strong>settings.py</strong> file.</p>

<div class="highlight"><pre><code class="python"><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">PROJECT_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">))</span> <span class="c"># needed because of shared hosting PYTHONPATH problems</span>

<span class="c"># MEDIA_ROOT = os.path.join(PROJECT_ROOT, &#39;public/appmedia/&#39;)</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="s">&#39;/full/local/path/to/appmedia/&#39;</span>
<span class="c"># MEDIA_URL = &#39;/appmedia/&#39;</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s">&#39;http://media.mysite.com/appmedia/&#39;</span>
<span class="n">ADMIN_MEDIA_PREFIX</span> <span class="o">=</span> <span class="s">&#39;http://media.mysite.com/media/&#39;</span>

<span class="n">TEMPLATE_DIRS</span> <span class="o">=</span> <span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PROJECT_ROOT</span><span class="p">,</span> <span class="s">&#39;templates&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span><span class="s">&#39;/&#39;</span><span class="p">),</span> <span class="p">)</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span> <span class="c"># add this</span>
    <span class="s">&#39;django.contrib.admindocs&#39;</span><span class="p">,</span> <span class="c"># and this</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c"># Add this to the bottom to import your local settings</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">settings_local</span> <span class="kn">import</span> <span class="o">*</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>
        
</code></pre>
</div>


<p>Now we need to create a settings_local.py file in the same directory as the main settings.py file:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>touch settings_local.py
</code></pre>
</div>


<p>Then add your default settings (most probably your dev settings):</p>

<div class="highlight"><pre><code class="python"><span class="n">DATABASE_ENGINE</span> <span class="o">=</span> <span class="s">&#39;mysql&#39;</span>     
<span class="n">DATABASE_NAME</span> <span class="o">=</span> <span class="s">&#39;mysite_com_dev&#39;</span>
<span class="n">DATABASE_USER</span> <span class="o">=</span> <span class="s">&#39;root&#39;</span>         
<span class="n">DATABASE_PASSWORD</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>         
<span class="n">DATABASE_HOST</span> <span class="o">=</span> <span class="s">&#39;localhost&#39;</span>    
<span class="n">DATABASE_PORT</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    
</code></pre>
</div>


<p>As we will be using multiple environments we need to have different configurations for each environment.  There are a number of ways to do this, however the DRYist and easiest is to have a main settings file that imports different settings according to the environment.</p>

<p>Change directory to the mysite-project/settings directory, and create the appropriate settings files - we will have a dev, staging and production file as well as the main one:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">cd </span>mysite-project/settings
<span class="nv">$ </span>touch settings_dev.py; touch settings_staging.py; touch settings_production.py
</code></pre>
</div>


<p>Now add the appropriate settings to these files database settings. Note that these settings will overwrite the settings in the main settings file.</p>

<h2>Adding South to Your Application</h2>

<p>For detailed installation instructions see <a href="http://south.aeracode.org/wiki/Download">http://south.aeracode.org/wiki/Download</a>.</p>

<p>Note, for MySQL databases, you should install South to a new instance of your MySQL database and not an existing or legacy database. This is because South won't update it's self when you run: <code>python manage.py migrate</code></p>

<p>Quick installation.</p>

<p>Add <strong>South</strong> (Note the capital 'S') to your pip requirements.txt file, and pip install it:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>pip install -r requirements.txt
</code></pre>
</div>


<p>Or just run:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>pip install South
</code></pre>
</div>


<p>Install the <strong>south</strong> (Note lowercase 's') into your project settings.py file. e.g.:</p>

<div class="highlight"><pre><code class="python"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.admindocs&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.contrib.sites&#39;</span><span class="p">,</span>
    <span class="s">&#39;south&#39;</span><span class="p">,</span>
<span class="p">)</span>
      
</code></pre>
</div>


<p>Now <strong>syncdb</strong> with your database so that your App knows about South.</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>python manage.py syncdb
</code></pre>
</div>


<p>You should get an output similar to this:</p>

<pre><code>Syncing...
Creating table south_migrationhistory

Synced:
 &gt; django.contrib.admin
 &gt; django.contrib.auth
 &gt; django.contrib.contenttypes
 &gt; django.contrib.sessions
 &gt; django.contrib.sites
 &gt; django.contrib.markup
 &gt; south
 &gt; tagging

Not synced (use migrations):
 - 
(use ./manage.py migrate to migrate these)
</code></pre>

<p>Finally you need to tell South what Apps you want it to manage (in terms of migrations). So for example say you have an App called 'firepages', then run:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>python manage.py startmigration firepages --initial
</code></pre>
</div>


<p>This will create a migrations directory and will allow South to manage all the models in that App:</p>

<pre><code>  Creating migrations directory at '/mypath/mysite-project/mysite.com/mysite/firepages/migrations'...
  Creating __init__.py in '/mypath/mysite-project/mysite.com/mysite/firepages/migrations'...
   + Added model 'firepages.Group'
   + Added model 'firepages.Category'
   + Added model 'firepages.Page'
  Created 0001_initial.py.
</code></pre>

<p>Note that because you will be uploading this new migrations directory you shouldn't need to run this command on the server.</p>

<p>You will now need to execute the following command to migrate forward:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>python manage.py migrate
</code></pre>
</div>


<p>Now if you want to change your database do the following:</p>

<ol>
<li>Modify your model. e.g. add / remove fields</li>
<li>Tell South to create a migration: <code>python manage.py startmigration myapp name-of-my-migration --auto</code></li>
<li>Execute the migration: <code>python manage.py migrate</code></li>
</ol>


<h2>Change urls.py</h2>

<p>Use the following imports:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>
    
</code></pre>
</div>


<p>At the bottom add a new URL path so that the site can get access to the appmedia, NB don't forget to add a staging and production version to:</p>

<div class="highlight"><pre><code class="python"><span class="c"># simple trick to use local css files for development.</span>
<span class="c"># (Just make sure DEBUG=False in production!!!)</span>
<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> 
        <span class="n">url</span><span class="p">(</span><span class="s">r&#39;^appmedia/(?P&lt;path&gt;.*)$&#39;</span><span class="p">,</span> <span class="s">&#39;django.views.static.serve&#39;</span><span class="p">,</span> <span class="p">{</span> 
            <span class="s">&#39;document_root&#39;</span><span class="p">:</span> <span class="n">settings</span><span class="o">.</span><span class="n">MEDIA_ROOT</span> <span class="p">}),</span>
        <span class="p">)</span>
</code></pre>
</div>


<p>Now add the following URLs:</p>

<div class="highlight"><pre><code class="python"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c">#Admin URLS</span>
    <span class="c"># (r&#39;^admin/doc/&#39;, include(&#39;django.contrib.admindocs.urls&#39;)),</span>
    <span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    
    <span class="c">#Home URL</span>
    <span class="p">(</span><span class="s">r&#39;^$&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s">&#39;mysite.foo.urls&#39;</span><span class="p">),</span>
<span class="p">)</span>
</code></pre>
</div>


<p>You may want to change the <strong>admin</strong> URL pattern to be something else. This will make the admin area more obscure thus helping to prevent hacking. e.g. <strong>mylogin</strong></p>

<h2>Add a views.py file</h2>

<p>In the mysite-production/mysite.com/mysite/ directory add a views.py file with the following:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="kn">import</span> <span class="nn">settings</span>

<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;quick hello test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s">&quot;Quick test, PROJECT_ROOT: </span><span class="si">%s</span><span class="s">&lt;br/&gt;URL path: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">PROJECT_ROOT</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
</code></pre>
</div>


<h2>Sync the DB and Start the Server</h2>

<p>Navigate to the mysite-project/mysite.com/mysite directory</p>

<p>Start the virtual environment:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>. ../../activate
<span class="o">(</span>virtual<span class="o">)</span><span class="nv">$ </span>python manage.py syncdb
** create a user **
<span class="o">(</span>virtual<span class="o">)</span><span class="nv">$ </span>python manage.py runserver
</code></pre>
</div>


<p>Now open a browser and point it at this URL:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>open http://localhost:8000
</code></pre>
</div>


<p>It should display your <strong>hello</strong> view results.</p>

<h2>Requirements</h2>

<p>Add a requirements.txt file to the following directory:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>touch mysite-project/mysite/requirements.txt
</code></pre>
</div>


<p>Add in any requirements e.g. django-tagging</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span><span class="nb">echo </span>mysite-project/mysite/requirements.txt &lt;&lt; django-tagging
</code></pre>
</div>


<p>Execute and add requirements:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>pip install -r requirements.txt 
</code></pre>
</div>


<h2>Local Apps Directory</h2>

<p>Create an <strong>apps</strong> directory in the root of your project folder. Then tell your settings.py file about it:</p>

<pre><code>  sys.path.insert(0, os.path.join(PROJECT_ROOT, "apps"))
</code></pre>

<p>Now any apps that you want in here and not in your "pip install" directory just add them and they will be found.</p>

<h2>RequestContext on All Views</h2>

<p>All your views should implement a RequestContext variable, but first you will need to add the following CONTEXT_PROCESSORS to the settings.py file:</p>

<div class="highlight"><pre><code class="python"><span class="n">TEMPLATE_CONTEXT_PROCESSORS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;django.core.context_processors.auth&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.core.context_processors.debug&#39;</span><span class="p">,</span> <span class="c"># passes the DEBUG variable to the template</span>
    <span class="s">&#39;django.core.context_processors.i18n&#39;</span><span class="p">,</span>
    <span class="s">&#39;django.core.context_processors.media&#39;</span><span class="p">,</span> <span class="c"># passes the MEDIA_URL to the template</span>
    <span class="s">&#39;django.core.context_processors.request&#39;</span><span class="p">,</span> <span class="c"># passes the request object to the template</span>
<span class="p">)</span>
</code></pre>
</div>


<p>Now Make sure that you pass the RequestContext to the render.</p>

<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">home_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;display home page&quot;&quot;&quot;</span>
    <span class="n">template</span> <span class="o">=</span> <span class="s">&quot;page_home.html&quot;</span> 
    <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="p">{</span> <span class="s">&#39;foo&#39;</span><span class="p">:</span><span class="s">&#39;bar&#39;</span> <span class="p">},</span> <span class="n">context_instance</span><span class="o">=</span><span class="n">RequestContext</span><span class="p">(</span><span class="n">request</span><span class="p">))</span>
</code></pre>
</div>


<p>This will allow you to use generic templates, and also get a handle on certain variables in the template.</p>

<h2>Page Specific Menus</h2>

<p>See this article for more information:  <a href="http://gnuvince.wordpress.com/2007/09/14/a-django-template-tag-for-the-current-active-page/">http://gnuvince.wordpress.com/2007/09/14/a-django-template-tag-for-the-current-active-page/</a></p>

<p>Django doesn't out of the box provide a <strong>current_page</strong> variable like Ruby on Rails - but it is easy enough to implement.</p>

<p>You will need to have the <strong>'django.core.context_processors.request',</strong> setting set in the template context processors as specified above.</p>

<p>You will also need to create a module called <strong>templatetags</strong> with a <strong>init</strong>.py file in it.
Now add a file called <strong>active_menus.py</strong></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django</span> <span class="kn">import</span> <span class="n">template</span>

<span class="n">register</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Library</span><span class="p">()</span>

<span class="nd">@register.simple_tag</span>
<span class="k">def</span> <span class="nf">link_to</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;&lt;span class=&quot;active&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="n">name</span>
    <span class="k">return</span> <span class="s">&#39;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            
</code></pre>
</div>


<p>Now in your template <em>load</em> this template tag and call it like this:</p>

<div class="highlight"><pre><code class="django"><span class="cp">{%</span> <span class="k">load</span> <span class="nv">active_menus</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">&lt;li&gt;</span><span class="cp">{%</span> <span class="k">link_to</span> <span class="nv">request</span> <span class="s2">&quot;^/$&quot;</span> <span class="s2">&quot;/&quot;</span> <span class="s2">&quot;home&quot;</span> <span class="cp">%}</span><span class="x">&lt;/li&gt;</span>
<span class="x">&lt;li&gt;</span><span class="cp">{%</span> <span class="k">link_to</span> <span class="nv">request</span> <span class="s2">&quot;^/software/$&quot;</span> <span class="s2">&quot;/software/&quot;</span> <span class="s2">&quot;software&quot;</span> <span class="cp">%}</span><span class="x">&lt;/li&gt;</span>
<span class="x">&lt;li&gt;</span><span class="cp">{%</span> <span class="k">link_to</span> <span class="nv">request</span> <span class="s2">&quot;^/books/$&quot;</span> <span class="s2">&quot;/books/&quot;</span> <span class="s2">&quot;books&quot;</span> <span class="cp">%}</span><span class="x">&lt;/li&gt;       </span>
</code></pre>
</div>


<h2>Template Includes</h2>

<p>When creating an include template file give it a name starting with an underscore e.g. <code>_nav.html</code></p>

<h2>Add a Sitemap to Your Site</h2>

<p>Add the following to your settings.py file in the INSTALLED_APPS section:</p>

<pre><code>    django.contrib.sitemaps
</code></pre>

<p>Now check that you have the following installed also.</p>

<p>This should be in the TEMPLATE_LOADERS:</p>

<pre><code>  'django.template.loaders.app_directories.load_template_source',
</code></pre>

<p>Make sure youâ€™ve installed the sites framework. Also make sure that you have set the site domain name and description correctly in the <strong>sites</strong> project in the <strong>Admin Panel</strong>.  It should not be <strong>example.com</strong>, but something like: <strong>myproject.com</strong></p>

<p>Create a <strong>sitemaps.py</strong> file in your project. This file should contain something like:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="kn">import</span> <span class="n">Sitemap</span>
<span class="kn">from</span> <span class="nn">myproject.models</span> <span class="kn">import</span> <span class="n">ProductPage</span><span class="p">,</span> <span class="n">ProductCategory</span>

<span class="k">class</span> <span class="nc">ProductPageSitemap</span><span class="p">(</span><span class="n">Sitemap</span><span class="p">):</span>
    <span class="n">changefreq</span> <span class="o">=</span> <span class="s">&quot;never&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ProductPage</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">published</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProductCategorySitemap</span><span class="p">(</span><span class="n">Sitemap</span><span class="p">):</span>
    <span class="n">changefreq</span> <span class="o">=</span> <span class="s">&quot;never&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ProductCategory</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre>
</div>


<p>Now add the following to your <strong>urls.py</strong> file:</p>

<div class="highlight"><pre><code class="python">        
<span class="kn">from</span> <span class="nn">myproject.sitemaps</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c"># from django.contrib.sitemaps import FlatPageSitemap, GenericSitemap</span>

<span class="n">sitemaps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;product_pages&#39;</span><span class="p">:</span> <span class="n">ProductPageSitemap</span><span class="p">,</span>
    <span class="s">&#39;product_categories&#39;</span><span class="p">:</span> <span class="n">ProductCategorySitemap</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
  <span class="p">(</span><span class="s">r&#39;^sitemap\.xml$&#39;</span><span class="p">,</span> <span class="s">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">})</span>
<span class="p">)</span>
</code></pre>
</div>


<h2>Adding a new App</h2>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>python manage.py startapp myappname
</code></pre>
</div>


<p>Add myappname to your settings.py file INSTALLED_APPS
Now create some models in your myappname/models.py file.</p>

<p>Then run a syncdb:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>python manage.py syncdb 
OR to see the SQL
<span class="nv">$ </span>python manage.py sql myappname
</code></pre>
</div>


<p>Now if you want to add South migrations:</p>

<div class="highlight"><pre><code class="bash"><span class="nv">$ </span>python manage.py startmigration myappname --initial
</code></pre>
</div>


<h2>Installing PIL</h2>

<p>PIL should not be installed as part of the requirements.txt file, as you will need to compile libjpeg first.</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>24 Jun 2010</span> &raquo; <a href="/2010/06/ruby-quine-example">Ruby Quine Example</a></li>
    
      <li><span>11 May 2010</span> &raquo; <a href="/2010/05/what-is-the-difference-between-a-proc-and-a-lambda-in-ruby">What is the Difference Between a Proc and a Lambda in Ruby?</a></li>
    
      <li><span>09 May 2010</span> &raquo; <a href="/2010/05/code-kata-four-exercise-a-ruby-solution">Code Kata Four Exercise - A Ruby Solution</a></li>
    
  </ul>
</div>
 
            <div class="footer">  
					    <div class="rss">
					      <a href="http://feeds.feedburner.com/ben-emson">
					        <img src="/images/rss.png" alt="Subscribe to RSS Feed" />
					      </a>
					    </div>
                <p>A project by <a href="http://blog.emson.co.uk">Ben Emson</a> | <a href="http://twitter.com/emson">@emson</a>.</p> 
            </div> 
 
        </div> 
				<!-- Google Analytics -->
    </body> 
</html>