<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>.Net not recognising regional settings</title> 
				<meta name="author" content="Ben Emson" />
				<link href="http://feeds.feedburner.com/ben-emson" rel="alternate" title="Ben Emsonr" type="application/atom+xml" />

			   <!-- syntax highlighting CSS -->
			   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

			   <!-- Homepage CSS -->
			   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
			   <script src="/mint/?js" type="text/javascript"></script>
    </head> 
 
    <body>  
        <div id="container"> 
 
            <h1><a href="http://blog.emson.co.uk">Ben Emson</a></h1> 
            
            <div id="post">
<h1>.Net not recognising regional settings</h1>

<p>The other day I had the following problem.
One of my test servers had been setup with US regional settings and should have been setup with UK settings.</p>

<p>The problem had been unnoticed for a while until our C# .Net application tried to call a stored procedure on a database on another server. This database server had UK regional settings.
The stored procedure expected to get a date in UK 'Long format'.  The error message was a database error saying something like:</p>

<pre><code>convertion error can't convert from NVarChar to DateTime
</code></pre>

<p>As the application was already compiled and being used on a live server I could not modify the code, I therefore had to run SQL Profiler and see what values were being passed into the stored procedure.  This is where I saw the US 'Long Date' format being passed in.</p>

<!--more-->


<h2>.Net regional settings fix</h2>

<p>So I tried changing the regional settings on my server back to the UK, but the application was still sending the US 'Long Date' value.
I dug real deep and suspected that IIS was doing something funny and found further regional settings in an <strong>Advanced</strong> tab, but still this didn't fix the issue.</p>

<p>The problem I soon discovered is that when you install the .Net framework it internalises the regional settings but when you try and change them on the server these internalised settings don't get changed.<br/>
The only solution to this is then to modify the <b>machine.config</b> file.</p>

<p>The <b>machine.config</b> file is in each installation of the .Net framework.  I happen to have both .Net 1.1 and .Net 2.0, however I changed the <b>machine.config</b> file in only the .Net 1.1 installation directory (even though our application is .Net 2.0) and all worked fine.
The <b>machine.config</b> can be found in this directory:</p>

<pre><code>C:\WINDOWS\Microsoft.NET\Framework\v1.1.4322\CONFIG
</code></pre>

<p>If you are using .Net 2.0 I'm sure you can make the same changes to the <strong>globalization</strong> XML node.
Please change the <strong>globalization</strong> XML node to have the correct cultural settings in our case <strong>en-GB</strong>:</p>

<pre><code>&lt;globalization
  fileEncoding="utf-8"
  requestEncoding="utf-8"
  responseEncoding="utf-8"
  culture="en-GB"
  uiCulture="en-GB"
/&gt;
</code></pre>

<p>To test that a .Net application would send the correct settings I wrote a simple test app which would print the 'Long Date' to the console.  Here is the source code if you want to quickly test it yourself:</p>

<p><strong>ShowLongDate.cs</strong></p>

<div class="highlight"><pre><code class="c"><span class="n">using</span> <span class="n">System</span><span class="p">;</span>
    
<span class="n">namespace</span> <span class="n">examples</span>
<span class="p">{</span>
    <span class="n">class</span> <span class="n">ShowLongDate</span>
    <span class="p">{</span>
        <span class="k">static</span> <span class="kt">void</span> <span class="n">Main</span><span class="p">(</span><span class="n">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">DateTime</span> <span class="n">current</span> <span class="o">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>
            <span class="n">string</span> <span class="n">longDate</span> <span class="o">=</span> <span class="n">current</span><span class="p">.</span><span class="n">ToLongDateString</span><span class="p">();</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Date as longDate: {0}&quot;</span><span class="p">,</span> <span class="n">longDate</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>


<h2>Interesting things I learned</h2>

<p>You can open the regional settings from the commandline or from <strong>Start/Run</strong> by typing</p>

<pre><code>    intl.cpl
</code></pre>

<p>Also all the regional settings are located in the registry here:</p>

<pre><code>    HKEY_CURRENT_USER/Control Panel/International
</code></pre>

<p>Useful URLs:
<a href="http://www.microsoft.com/globaldev/reference/localetable.mspx">http://www.microsoft.com/globaldev/reference/localetable.mspx</a></p>

<p>Anyway I hope this helps if you have the same problem.</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>24 Jun 2010</span> &raquo; <a href="/2010/06/ruby-quine-example">Ruby Quine Example</a></li>
    
      <li><span>11 May 2010</span> &raquo; <a href="/2010/05/what-is-the-difference-between-a-proc-and-a-lambda-in-ruby">What is the Difference Between a Proc and a Lambda in Ruby?</a></li>
    
      <li><span>09 May 2010</span> &raquo; <a href="/2010/05/code-kata-four-exercise-a-ruby-solution">Code Kata Four Exercise - A Ruby Solution</a></li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emson'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    var disqus_identifier = '/2008/05/net-not-recognising-regional-settings';
    var disqus_url = 'http://blog.emson.co.uk/2008/05/net-not-recognising-regional-settings';
    var disqus_title = '.Net not recognising regional settings';
    // var disqus_developer = 1;
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
 
            <div class="footer">
                <p>A project by <a href="http://blog.emson.co.uk">Ben Emson</a> | <a href="http://twitter.com/emson">@emson</a>.</p> 
            </div> 
 
        </div> 
				<!-- Google Analytics -->
    </body> 
</html>