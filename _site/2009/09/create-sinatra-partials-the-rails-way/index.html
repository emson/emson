<!DOCTYPE html> 
<html lang="en"> 
    <head> 
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>Create Sinatra Partials The Rails Way</title> 
				<meta name="author" content="Ben Emson" />
				<link href="http://feeds.feedburner.com/ben-emson" rel="alternate" title="Ben Emsonr" type="application/atom+xml" />

			   <!-- syntax highlighting CSS -->
			   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

			   <!-- Homepage CSS -->
			   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
			   <script src="/mint/?js" type="text/javascript"></script>
    </head> 
 
    <body>  
        <div id="container"> 
 
            <h1><a href="http://blog.emson.co.uk">Ben Emson</a></h1> 
            
            <div id="post">
<h1>Create Sinatra Partials The Rails Way</h1>

<p>This is just a quick post. I've been playing around with the <a href="http://www.sinatrarb.com/">Sinatra micro web framework</a>, and have to say that it is excellent. It really is the perfect tool for rapidly creating small and useful <a href="http://www.ruby-lang.org/en/">Ruby</a> micro-sites.</p>

<p>Being small and lightweight it doesn't have many of the features of larger frameworks like <a href="http://rubyonrails.org/">Ruby on Rails</a>. One of the features I've begun to need is the handling of Rails like partials.</p>

<p>Notably I need to pass both local variables and collections to the partial code and have the partials rendered accordingly.
I started implementing my own version, and then came across a nice little <a href="http://github.com/">Github</a> project: <a href="http://github.com/sbfaulkner/sinatra-helpers">Sinatra-Helpers by sbfaulkner</a>.</p>

<p>Anyway here is the code he uses for Sinatra partials:</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">haml_partial</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">item_name</span> <span class="o">=</span> <span class="nb">name</span><span class="o">.</span><span class="n">to_sym</span>
  <span class="n">counter_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">_counter&quot;</span><span class="o">.</span><span class="n">to_sym</span>
  <span class="k">if</span> <span class="n">collection</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:collection</span><span class="p">)</span>
    <span class="n">collection</span><span class="o">.</span><span class="n">enum_for</span><span class="p">(</span><span class="ss">:each_with_index</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span><span class="n">index</span><span class="o">|</span>
      <span class="n">haml_partial</span> <span class="nb">name</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="n">item_name</span> <span class="o">=&gt;</span> <span class="n">item</span><span class="p">,</span> <span class="n">counter_name</span> <span class="o">=&gt;</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span>
    <span class="k">end</span><span class="o">.</span><span class="n">join</span>
  <span class="k">elsif</span> <span class="n">object</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:object</span><span class="p">)</span>
    <span class="n">haml_partial</span> <span class="nb">name</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="n">item_name</span> <span class="o">=&gt;</span> <span class="n">object</span><span class="p">,</span> <span class="n">counter_name</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">})</span>
  <span class="k">else</span>
    <span class="n">haml</span> <span class="s2">&quot;_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">to_sym</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>


<p>You can use his project or if you just need this feature just pop this code into your Sinatra helpers file  <strong>application_helper.rb</strong>:</p>

<div class="highlight"><pre><code class="ruby"><span class="n">helpers</span> <span class="k">do</span>

  <span class="k">def</span> <span class="nf">partial</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="n">item_name</span> <span class="o">=</span> <span class="nb">name</span><span class="o">.</span><span class="n">to_sym</span>
    <span class="n">counter_name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">_counter&quot;</span><span class="o">.</span><span class="n">to_sym</span>
    <span class="k">if</span> <span class="n">collection</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:collection</span><span class="p">)</span>
      <span class="n">collection</span><span class="o">.</span><span class="n">enum_for</span><span class="p">(</span><span class="ss">:each_with_index</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span>
        <span class="n">partial</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="n">item_name</span> <span class="o">=&gt;</span> <span class="n">item</span><span class="p">,</span> <span class="n">counter_name</span> <span class="o">=&gt;</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}))</span>
      <span class="k">end</span><span class="o">.</span><span class="n">join</span>

    <span class="k">elsif</span> <span class="n">object</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="ss">:object</span><span class="p">)</span>
      <span class="n">partial</span> <span class="nb">name</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="n">item_name</span> <span class="o">=&gt;</span> <span class="n">object</span><span class="p">,</span> <span class="n">counter_name</span> <span class="o">=&gt;</span> <span class="kp">nil</span><span class="p">})</span>
    <span class="k">else</span>
      <span class="n">haml</span> <span class="s2">&quot;_</span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">to_sym</span><span class="p">,</span> <span class="n">options</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="ss">:layout</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>


<p>Now you can call the partial from a your page e.g. <strong>index.haml</strong></p>

<div class="highlight"><pre><code class="haml"><span class="p">=</span> <span class="n">partial</span><span class="p">(</span><span class="s2">&quot;mypartial&quot;</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:var1</span> <span class="o">=&gt;</span> <span class="s2">&quot;value 1&quot;</span><span class="p">,</span> <span class="ss">:var2</span> <span class="o">=&gt;</span> <span class="s2">&quot;value 2 and so on&quot;</span><span class="p">})</span>
</code></pre>
</div>


<p>Create a partial in the same directory as the calling page. Note that this code doesn't like filenames truncated with a '-', so avoid this if possible. Also like in Rails your partials should start with an underscore. e.g.  <strong>_mypartial.haml</strong></p>

<p>To access the variable from this partial simply call the local variable name in your code:</p>

<div class="highlight"><pre><code class="haml"><span class="nt">%h2</span> 
  This is var1:
  <span class="p">=</span> <span class="n">var1</span>
  
<span class="nt">%p</span> 
  And this is var2:
  <span class="p">=</span> <span class="n">var2</span>
</code></pre>
</div>


<p>Handling collections, again, is similar to the way Rails handles partial collections. From your page call the partial with a collection such as:</p>

<div class="highlight"><pre><code class="haml"><span class="p">=</span> <span class="n">partial</span><span class="p">(</span><span class="s2">&quot;listitem&quot;</span><span class="p">,</span> <span class="ss">:collection</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">&quot;item 1&quot;</span><span class="p">,</span> <span class="s2">&quot;item 2 and so on&quot;</span><span class="o">]</span><span class="p">)</span>
</code></pre>
</div>


<p>Now in the <strong>_listitem.haml</strong> partial code simply provide the partial name as a variable or the partialname with _counter for the increment number e.g.</p>

<div class="highlight"><pre><code class="haml"><span class="nt">%li</span>
  <span class="p">=</span> <span class="n">listitem</span>
  is the 
  <span class="p">=</span> <span class="n">listitem_counter</span>
  in this array
</code></pre>
</div>


<p>Anyway all pretty basic stuff but I hope it helps the casual Sinatra surfer.</p>

<p>Goodluck.</p>

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>24 Jun 2010</span> &raquo; <a href="/2010/06/ruby-quine-example">Ruby Quine Example</a></li>
    
      <li><span>11 May 2010</span> &raquo; <a href="/2010/05/what-is-the-difference-between-a-proc-and-a-lambda-in-ruby">What is the Difference Between a Proc and a Lambda in Ruby?</a></li>
    
      <li><span>09 May 2010</span> &raquo; <a href="/2010/05/code-kata-four-exercise-a-ruby-solution">Code Kata Four Exercise - A Ruby Solution</a></li>
    
  </ul>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'emson'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    var disqus_identifier = '/2009/09/create-sinatra-partials-the-rails-way';
    var disqus_url = 'http://blog.emson.co.uk/2009/09/create-sinatra-partials-the-rails-way';
    var disqus_title = 'Create Sinatra Partials The Rails Way';
    // var disqus_developer = 1;
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
 
            <div class="footer">
                <p>A project by <a href="http://blog.emson.co.uk">Ben Emson</a> | <a href="http://twitter.com/emson">@emson</a>.</p> 
            </div> 
 
        </div> 
				<!-- Google Analytics -->
    </body> 
</html>